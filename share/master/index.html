<!DOCTYPE html>
<html lang="de">
  <head>
    <title>SunRiser Finder</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <base href="/">
    <style>
      .hideme { display:none; }
    </style>
  </head>
  <body>
    <h1>SunRiser Finder</h1>
    <h2 id="not_found" class="hideme">Wir haben keinen SunRiser gefunden, der sich von Ihrer Internet Adresse gemeldet hat. Bitte achten Sie darauf diese Seite &uuml;ber die gleiche Internet Verbindung zu benutzen, wie die vom SunRiser selbst! &Uuml;berpr&uuml;fen Sie auch nochmal alle Kabel Verbindungen und verbinden Sie den SunRiser erneut mit der Stromversorgung und laden Sie dann nach einer Minute diese Seite nochmal.</h2>
    <h2 id="service_down" class="hideme">Der Service ist gerade nicht verf&uuml;gbar, bitte versuchen Sie es sp&auml;ter nochmal. (Dies k&ouml;nnte auch eine Fehlfunktion in Ihrem Browser sein. Falls Sie auch nach 24 Stunden diese Meldung bekommen, melden Sie sich bitte beim Support.)</h2>
    <h2 id="found"></h2>
    <script src="/jquery-1.11.2.min.js" type="text/javascript"></script>
<script type="text/javascript">

var srf_done_cnt = 0;
var sr_finder;
var sr_firmwares;

function srf_error() {
  $('#service_down').show();
}

function srf_done() {
  srf_done_cnt = srf_done_cnt + 1;
  if (srf_done_cnt == 2) {
    if (typeof sr_finder === 'undefined' || typeof sr_firmwares === 'undefined') {
      srf_error();
    } else {
      $.each(sr_finder,function(mac,sr){
        $('#found').append('<div class="sr_found"><a href="http://' + sr.ip + '/">' + hostname
          + ' [' + mac + ']</a> [' + sr.firmware + ' / ' + sr.firmware_timestamp + ']</div>');
      });
    }
  }
}

$(function(){

  $.getJSON("sunriser_firmware_images.json?" + (new Date().getTime()), function(firmwares) {
    sr_firmwares = firmwares;
    srf_done();
  }).error(function() { srf_error() });
  $.getJSON("finder?" + (new Date().getTime()), function(finder) {
    sr_finder = finder;
    srf_done();
  }).error(function() { srf_error() });

});

</script>
  </body>
</html>
